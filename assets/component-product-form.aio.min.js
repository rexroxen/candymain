/*
Generated time: November 27, 2024 07:21
This file was created by the app developer. Feel free to contact the original developer with any questions. It was minified (compressed) by AVADA. AVADA do NOT own this script.
*/
(()=>{class t extends HTMLElement{constructor(){super(),this.cacheDOMElements(),this.onSubmitBound=this.onSubmit.bind(this),Array.from(this.noscriptElements).forEach(t=>t.remove())}cacheDOMElements(){this.form=this.querySelector("form"),this.noscriptElements=this.querySelectorAll("noscript"),this.sectionId=this.getAttribute("data-section-id"),this.productInformation=this.closest("product-information"),this.cartAction=document.getElementById("PageContainer").dataset.cartAction,this.cartType=document.getElementById("PageContainer").dataset.cartType,this.cartCountIndicator=document.querySelector("[data-cart-count-indicator]"),this.giftWrapProductId=this.getAttribute("data-gift-wrap-product-id"),this.wethemeGlobal=document.querySelector("script#wetheme-global"),this.translationsObject=JSON.parse(this.wethemeGlobal.textContent),this.qtyErrorMessage=this.querySelector("[data-qty-error-message]")}connectedCallback(){this.form&&this.attachEventListeners()}attachEventListeners(){this.form.addEventListener("submit",this.onSubmitBound)}onSubmit(t){t.preventDefault(),this.prepareForSubmission()}prepareForSubmission(){this.cacheSubmissionElements(),this.checkRequiredInputs()&&(this.showLoadingState(),this.appendPropertiesAsHiddenInputs(),this.addItemsToCart())}cacheSubmissionElements(){this.loadingIcon=this.form.querySelector("[data-loading-icon]"),this.addToCartText=this.form.querySelector("[data-add-to-cart-text]"),this.addedText=this.form.querySelector("[data-cart-added-text]"),this.quantityInput=this.form.querySelector('[name="quantity"]'),this.quantity=this.quantityInput&&parseInt(this.quantityInput.value,10)||1}fetchConfig(t="json"){return{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/"+t}}}checkRequiredInputs(){var t=Array.from(this.form.querySelectorAll("[required]:not(:disabled)")),t=(this.clearErrorMessages(),t.filter(t=>!t.value.trim()));return t.forEach(t=>this.applyErrorMessage(t)),0===t.length}clearErrorMessages(){this.form.querySelectorAll(".required-field-error").forEach(t=>t.remove())}applyErrorMessage(t){var e=this.translationsObject.translations.required_input_error;t.insertAdjacentHTML("afterend",`<span class="required-field-error" style="color:var(--error-color);">${e}</span>`),t.classList.contains("input-error")||(t.classList.add("input-error"),t.focus())}appendPropertiesAsHiddenInputs(){this.productInformation&&(this.removeAllDynamicHiddenInputs(),this.addPropertyInputs(),this.disableEmptyInputs())}disableEmptyInputs(){this.form.querySelectorAll("input, textarea").forEach(t=>{t.value||(t.disabled=!0)})}removeAllDynamicHiddenInputs(){this.form.querySelectorAll(".dynamic-hidden-input").forEach(t=>t.remove())}addPropertyInputs(){this.productInformation.querySelectorAll('[data-custom-property][name^="properties["]').forEach(t=>this.constructHiddenInput(t))}constructHiddenInput(t){var e;this.shouldElementBeIgnored(t)||((e=document.createElement("input")).type="hidden",e.name=t.name,e.value=t.value,e.classList.add("dynamic-hidden-input"),this.form.appendChild(e))}shouldElementBeIgnored(t){return"file"===t.type?this.handleFileInput(t):("checkbox"===t.type||"radio"===t.type)&&!t.checked||"checkbox"!==t.type&&"radio"!==t.type&&!t.value}handleFileInput(t){return t.style.display="none",this.form.appendChild(t),!0}giftWrapEnabled(){return!!this.form.querySelector('[name="properties[Gift wrap]"]')&&""!==this.giftWrapProductId}async addItemsToCart(){try{var t=await this.addProductToCart(routes.cart_add_url,this.fetchConfigWithBody());t&&this.giftWrapEnabled()&&await this.addProductToCart(routes.cart_add_url,this.additionalProductConfig(this.giftWrapProductId,this.quantity)),this.processResponse(t)}catch(t){console.error("Error adding item(s) to cart: "+(t.description||t.message))}}async addProductToCart(t,e){t=await fetch(t,e);return t.ok||console.error("Error adding item to cart: "+(t.description||t.statusText)),t}additionalProductConfig(t,e){return{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({items:[{id:t,quantity:e}]})}}async getCart(){try{return await(await fetch(routes.cart_url+"?view=compare")).json()}catch(t){console.error("Error fetching cart: "+(t.description||t.message))}}updateCartCountIndicator(){this.cartCountIndicator&&(this.getCart().then(t=>this.cartCountIndicator.textContent=t.item_count),this.cartCountIndicator.classList.contains("hide"))&&this.cartCountIndicator.classList.remove("hide")}fetchConfigWithBody(){var t=this.fetchConfig("javascript");return t.headers["X-Requested-With"]="XMLHttpRequest",delete t.headers["Content-Type"],t.body=new FormData(this.form),t}processResponse(t){t.ok&&this.hideLoadingState(),422===t.status&&(this.hideLoadingState(),this.qtyErrorMessage)&&this.qtyErrorMessage.classList.remove("hidden"),eventBus.emit("cart:added",{sectionId:this.sectionId})}toggleCartDrawer(){this.getCart().then(t=>{eventBus.emit("toggle:right:drawer",{type:"cart",forceOpen:!0,params:{cart:t}})}).catch(t=>{console.error("Error fetching cart: "+t)})}showLoadingState(){this.toggleElements(this.addToCartText,!1),this.toggleElements(this.loadingIcon,!0,"hidden"),this.toggleAddButton(!0)}hideLoadingState(){this.toggleElements(this.loadingIcon,!1,"hidden"),this.toggleCartActionDisplay()}toggleCartActionDisplay(){"show_added_message"===this.cartAction&&this.addedText?(this.addedText.style.display="block",setTimeout(()=>{this.toggleAddToCartText(!0),this.toggleAddButton(!1),this.updateCartCountIndicator()},2e3)):"drawer"===this.cartType&&"go_to_or_open_cart"===this.cartAction?(this.toggleAddToCartText(!0),this.toggleCartDrawer(),this.toggleAddButton(!1)):(this.toggleAddToCartText(!0),this.toggleAddButton(!1),window.location=window.routes.cart_url)}toggleAddToCartText(t){this.addedText&&(this.addedText.style.display=t?"none":"block"),this.addToCartText&&(this.addToCartText.style.display=t?"block":"none")}toggleElements(t,e,r){t&&(r?e?t.classList.remove(r):t.classList.add(r):t.style.display=e?"block":"none")}toggleAddButton(t=!0){var e=this.querySelector('[name="add"]');e&&(e.disabled=t)}disconnectedCallback(){this.form.removeEventListener("submit",this.onSubmitBound)}}customElements.get("product-form")||customElements.define("product-form",t)})();