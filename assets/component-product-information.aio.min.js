/*
Generated time: November 27, 2024 07:21
This file was created by the app developer. Feel free to contact the original developer with any questions. It was minified (compressed) by AVADA. AVADA do NOT own this script.
*/
customElements.get("product-information")||customElements.define("product-information",class extends HTMLElement{constructor(){super(),this.dataCache=new Map,this.init()}init(){this.cacheDOMElements(),this.bindEventHandlers()}cacheDOMElements(){this.sectionId=this.getAttribute("data-section-id"),this.sectionFetchId=this.getAttribute("data-section-fetch-id"),this.isQuickView="true"===this.dataset.quickView,this.productForm=this.querySelector("product-form"),this.productUrl=this.dataset.url,this.elementsToUpdate=this.querySelectorAll('[data-updates-on-change="true"]'),this.formQuantityInput=this.productForm?.querySelector('[name="quantity"]'),this.stickyContainer=this.classList.contains("product-sticky")?this:null,this.stickyHeader=document.querySelector(".header-section"),this.enableURLUpdate="true"===this.dataset.enableUrlUpdate,this.variantCount=this.getVariantData().length,this.qtyErrorMessage=this.productForm?.querySelector("[data-qty-error-message]"),this.isFeaturedProduct="true"===this.dataset.isFeaturedProduct}connectedCallback(){this.updateOptions(),this.setStickyOffset(),this.attachEventListeners()}disconnectedCallback(){this.removeEventListeners()}bindEventHandlers(){this.resizeHandler=this.handleResize.bind(this),this.onQuantityChange=this.handleQuantityChange.bind(this),this.onVariantChange=this.handleVariantChange.bind(this)}attachEventListeners(){this.addEventListener("mouseover",this.preFetchAllVariantData.bind(this),{once:!0}),this.addEventListener("touchstart",this.preFetchAllVariantData.bind(this),{once:!0}),window.addEventListener("resize",this.resizeHandler),eventBus.on("qty:change",this.onQuantityChange),eventBus.on("variant:change",this.onVariantChange)}removeEventListeners(){window.removeEventListener("resize",this.resizeHandler),eventBus.off("qty:change",this.onQuantityChange),eventBus.off("variant:change",this.onVariantChange)}preFetchAllVariantData(){this.variantCount<=1||this.isFeaturedProduct&&window.Shopify.designMode||this.getVariantData().forEach(t=>{let e=`${this.productUrl}?section_id=${this.sectionFetchId}&variant=`+t.id;this.dataCache.has(e)||fetch(e).then(t=>t.text()).then(t=>{this.dataCache.set(e,t)}).catch(t=>{console.error("Error pre-fetching data for variant:",t)})})}handleResize(){window.Shopify.designMode&&this.setStickyOffset()}handleQuantityChange(t){this.clearErrors(),this.formQuantityInput&&t.value&&(t.sectionId&&t.sectionId!==this.sectionId||(this.formQuantityInput.value=t.value))}setStickyOffset(){this.stickyContainer&&this.stickyHeader&&(this.stickyContainer.style.top=this.stickyHeader.offsetHeight+"px")}updateOptions(){this.options=Array.from(this.querySelectorAll("variant-dropdown, product-swatch")).map(t=>"VARIANT-DROPDOWN"===t.tagName?t.querySelector("[data-dropdown-list]")?.querySelector("[data-dropdown-option].selected")?.getAttribute("data-option-value"):"PRODUCT-SWATCH"===t.tagName?t.querySelector("input:checked")?.value:void 0).filter(Boolean)}async handleVariantChange(t){var e;this.variantCount<=1||t.sectionId&&t.sectionId!==this.sectionId||(this.clearErrors(),this.updateOptions(),t.variant?this.currentVariant=t.variant:this.getCurrentVariant(),this.currentVariant?(this.toggleAddButton(this.currentVariant.available),e=`${this.productUrl}?section_id=${this.sectionFetchId}&variant=`+this.currentVariant.id,!this.dataCache.has(e)||this.isFeaturedProduct||window.Shopify.designMode?await this.fetchAndUpdate(e,t):this.updateFromCache(e,t)):this.handleInvalidVariant())}handleInvalidVariant(){this.toggleAddButton(!1);var t=this.productForm?.querySelector('[name="add"]');t&&(t=t.querySelector("[data-add-to-cart-text]"))&&(t.textContent=t.getAttribute("data-unavailable-text"),t=this.querySelector("[data-product-price]"))&&(t=t.querySelector("span[data-price-text]"))&&(t.textContent=t.getAttribute("data-unavailable-text"))}async fetchAndUpdate(t,e){if(t&&this.sectionId)try{this.updateOptions(),this.enableURLUpdate&&this.updateURL();var a=await fetch(t);if(!a.ok)throw new Error("HTTP error! status: "+a.status);var i=await a.text();this.updateDOMWithFetchedData(i,e),this.dataCache.set(t,i)}catch(t){console.error("Failed to update product information:",t)}}updateFromCache(t,e){this.enableURLUpdate&&this.updateURL();t=this.dataCache.get(t);this.updateDOMWithFetchedData(t,e)}updateDOMWithFetchedData(t,e){var a,t=this.parseHTML(t);this.isQuickView?(a=t.querySelector("template[data-quick-view-product]")?.content,this.updateDOM(a,e)):this.updateDOM(t,e)}parseHTML(t){return(new DOMParser).parseFromString(t,"text/html")}updateDOM(t,e={}){this.replaceElements(t,e),this.formQuantityInput&&(this.formQuantityInput.value=1),e.fromSlideChange||eventBus.emit("variant:updated",{variant:this.currentVariant,sectionId:this.sectionId})}toggleAddButton(t){var e=this.productForm?.querySelector('[name="add"]');e&&e.toggleAttribute("disabled",!t)}updateURL(){this.currentVariant&&window.history.replaceState({},"",this.productUrl+"?variant="+this.currentVariant.id)}replaceElements(t,e=0){if(t&&this.elementsToUpdate.length){let a=t.querySelector(`product-information[data-section-id="${this.sectionId}"][data-url="${this.productUrl}"]`);a&&this.elementsToUpdate.forEach(t=>{var t=t.getAttribute("data-block-id"),e=this.querySelector(`[data-block-id="${t}"]`);let i=a.querySelector(`[data-block-id="${t}"]`);t&&e&&i&&e.querySelectorAll("[data-update-item]").forEach(t=>{var e=t.getAttribute("data-update-item"),a=i.querySelector(`[data-update-item="${e}"]`);e&&a&&t.replaceWith(a)})})}}clearErrors(){this.qtyErrorMessage&&this.qtyErrorMessage.classList.add("hidden")}getCurrentVariant(){var t=this.getVariantData();this.currentVariant=t.find(t=>t.options.every((t,e)=>t===this.options[e]))||null}getVariantData(){var t;return this.variantData||(t=this.querySelector('script[type="application/json"]'),this.variantData=t?JSON.parse(t.textContent):{}),this.variantData}});